---
export interface FaqItem {
  question: string;
  answer: string;
}

interface Props {
  items: FaqItem[];
  id?: string;
}

const { items, id = "faq" } = Astro.props;
---

<div class="space-y-0" id={id}>
  {items.map((item, index) => (
    <div class="faq-item">
      <button
        class="faq-trigger"
        aria-expanded="false"
        aria-controls={`${id}-content-${index}`}
        id={`${id}-trigger-${index}`}
      >
        <span>{item.question}</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
        </svg>
      </button>
      <div
        class="faq-content"
        id={`${id}-content-${index}`}
        role="region"
        aria-labelledby={`${id}-trigger-${index}`}
        data-open="false"
      >
        <div class="faq-content-inner">
          {item.answer}
        </div>
      </div>
    </div>
  ))}
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    document.querySelectorAll('.faq-trigger').forEach((trigger) => {
      trigger.addEventListener('click', () => {
        const expanded = trigger.getAttribute('aria-expanded') === 'true';
        const contentId = trigger.getAttribute('aria-controls');
        const content = contentId ? document.getElementById(contentId) : null;

        if (!content) return;

        if (expanded) {
          trigger.setAttribute('aria-expanded', 'false');
          content.setAttribute('data-open', 'false');
        } else {
          trigger.setAttribute('aria-expanded', 'true');
          content.setAttribute('data-open', 'true');
        }
      });
    });
  });
</script>
