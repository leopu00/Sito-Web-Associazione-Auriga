---
import BaseLayout from "../layouts/BaseLayout.astro";

type EventEntry = {
  id: string;
  category: string;
  title: string;
  date: string;
  location: string;
  description: string;
  image: string;
  imageAlt: string;
  link?: string;
};

type TimelineScope = "upcoming" | "past";

type TimelineEventItem = EventEntry & {
  type: "event";
  scope: TimelineScope;
  positionIndex: number;
  isInverted: boolean;
  ctaHref: string;
};

type TimelineDividerItem = {
  type: "divider";
  id: string;
  title: string;
  description?: string;
};

type TimelineItem = TimelineEventItem | TimelineDividerItem;

const upcomingEvents: EventEntry[] = [
  {
    id: "sei-modalita",
    category: "arteterapia",
    title: "Sei modalità di comunicazione",
    date: "Dal 19 al 21 Settembre 2025",
    location: "Accademia Aldo Bargero Oriago, Oriago (VE)",
    description:
      "Tre giorni di arteterapia per esplorare le sei modalità con cui corpo, voce e immaginazione costruiscono relazione, ascolto e cura.",
    image: "/img/accademia-aldo-bargero-2.jpg",
    imageAlt: "Ingresso dell'Accademia Oriago con luce del tramonto",
    link: "/arteterapia",
  },
];

const pastEvents: EventEntry[] = [
  {
    id: "battaglia-rane-topi-2025-maggio",
    category: "teatro",
    title: "La battaglia delle rane e dei topi",
    date: "26 Maggio 2025",
    location: "Etica Bio Festival di Caulonia",
    description:
      "Spettacolo itinerante dal poemetto greco, con un viaggio condiviso tra comunità e scuole in tre tappe successive.",
    image: "/img/battaglia-rane-topi/DSCF3912.jpg",
    imageAlt: "Scena teatrale de La battaglia delle rane e dei topi",
    link: "/teatro/battaglia-rane-topi",
  },
  {
    id: "battaglia-rane-topi-2025-aprile",
    category: "teatro",
    title: "La battaglia delle rane e dei topi",
    date: "Aprile 2025",
    location: "Scuole Waldorf del Veneto",
    description:
      "Spettacolo itinerante dal poemetto greco, con un viaggio condiviso tra comunità e scuole in tre tappe successive.",
    image: "/img/battaglia-rane-topi/DSCF3912.jpg",
    imageAlt: "Scena teatrale de La battaglia delle rane e dei topi",
    link: "/teatro/battaglia-rane-topi",
  },
  {
    id: "premio-paolo-giuranna-2025",
    category: "poesia",
    title: "Premio Paolo Giuranna II.",
    date: "Marzo 2025",
    location: "Teatrino \"Eleonora Duse\", Roma",
    description:
      "Edizione 2025 del concorso per giovani interpreti, con finale aperta al pubblico nello storico teatrino romano.",
    image: "/img/premio-paolo-giuranna/_02A1876.JPG",
    imageAlt: "Vincitori del Premio Paolo Giuranna sul palco",
    link: "/poesia/premio-paolo-giuranna",
  },
  {
    id: "citta-poesia-4",
    category: "poesia",
    title: "La Città della Poesia IV.",
    date: "14 Dicembre 2024",
    location: "CAE",
    description:
      "Quarto appuntamento della rassegna con letture sceniche, musica e voci giovani dedicate alla poesia contemporanea.",
    image: "/img/citta-della-poesia/_DSF5401.JPG",
    imageAlt: "Momento di lettura durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
  {
    id: "convegno-sprachgestaltung",
    category: "convegno",
    title: "Convegno sulla Sprachgestaltung",
    date: "11 Ottobre 2024",
    location: "Nuovo Teatro Ateneo 'Università La Sapienza'",
    description:
      "Una giornata di studio dedicata alla Sprachgestaltung con docenti e professionisti del linguaggio scenico e pedagogico.",
    image: "/img/sapienzacorso.jpg",
    imageAlt: "Relatori riuniti al Nuovo Teatro Ateneo della Sapienza",
    link: "/formazione/corsi-intensivi",
  },
  {
    id: "la-tempesta-continua-2024-ottobre",
    category: "teatro",
    title: "La tempesta continua",
    date: "10 Ottobre 2024",
    location: "Nuovo Teatro Ateneo 'Università La Sapienza'",
    description:
      "Nuova produzione liberamente ispirata alla Tempesta di Shakespeare, con musiche originali e un cast internazionale.",
    image: "/img/tempesta-continua.jpg",
    imageAlt: "Scena centrale dello spettacolo La tempesta continua",
    link: "/teatro/tempesta-continua",
  },
  {
    id: "la-tempesta-continua-2024-luglio",
    category: "teatro",
    title: "La tempesta continua",
    date: "11 Luglio 2024",
    location: "Goetheaunm - Dornach",
    description:
      "Nuova produzione liberamente ispirata alla Tempesta di Shakespeare, con musiche originali e un cast internazionale.",
    image: "/img/tempesta-continua.jpg",
    imageAlt: "Scena centrale dello spettacolo La tempesta continua",
    link: "/teatro/tempesta-continua",
  },
  {
    id: "battaglia-rane-topi-2024-giugno",
    category: "teatro",
    title: "La battaglia delle rane e dei topi",
    date: "Giugno 2024",
    location: "CAE",
    description:
      "Spettacolo itinerante dal poemetto greco, con un viaggio condiviso tra comunità e scuole in tre tappe successive.",
    image: "/img/battaglia-rane-topi/DSCF3912.jpg",
    imageAlt: "Scena teatrale de La battaglia delle rane e dei topi",
    link: "/teatro/battaglia-rane-topi",
  },
  {
    id: "citta-poesia-3",
    category: "poesia",
    title: "La Città della Poesia III.",
    date: "13 Aprile 2024",
    location: "CAE",
    description:
      "Terzo incontro del ciclo con poeti ospiti, musica dal vivo e la partecipazione degli allievi dei corsi Auriga.",
    image: "/img/citta-della-poesia/_DSF5371.JPG",
    imageAlt: "Pubblico coinvolto durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
  {
    id: "premio-paolo-giuranna-2024",
    category: "poesia",
    title: "Premio Paolo Giuranna I.",
    date: "Marzo 2024",
    location: "Teatrino \"Eleonora Duse\", Roma",
    description:
      "L'edizione 2024 del premio ha dato voce a giovani interpreti provenienti da tutta Italia con prove e finale pubblica.",
    image: "/img/premio-paolo-giuranna/_MG_0518.JPG",
    imageAlt: "Interprete sul palco del Premio Paolo Giuranna",
    link: "/poesia/premio-paolo-giuranna",
  },
  {
    id: "il-paradiso",
    category: "teatro",
    title: "Il Paradiso",
    date: "Dal 14 al 16 Febbraio 2024",
    location: "Teatro Belli, Roma",
    description:
      "Messa in scena della terza cantica dantesca con un lavoro corale su voce, luce e movimento.",
    image: "/img/paradiso.jpg",
    imageAlt: "Ensemble in scena durante Il Paradiso",
    link: "/teatro/paradiso",
  },
  {
    id: "citta-poesia-2",
    category: "poesia",
    title: "La Città della Poesia II.",
    date: "20 Gennaio 2024",
    location: "CAE",
    description:
      "Secondo appuntamento della rassegna con focus sulla poesia del Novecento letta ad alta voce e accompagnata da musica.",
    image: "/img/citta-della-poesia/_DSF5326.JPG",
    imageAlt: "Attori e musicisti durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
  {
    id: "citta-poesia-1",
    category: "poesia",
    title: "La Città della Poesia I.",
    date: "24 Novembre 2023",
    location: "CAE",
    description:
      "Debutto della rassegna con letture corali, improvvisazioni e incontri con il pubblico della città.",
    image: "/img/citta-della-poesia/Poesia2.webp",
    imageAlt: "Lettura scenica durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
];

let timelineOrder = 0;

const buildTimelineEvent = (event: EventEntry, scope: TimelineScope): TimelineEventItem => {
  const positionIndex = timelineOrder++;
  return {
    ...event,
    type: "event",
    scope,
    positionIndex,
    isInverted: positionIndex % 2 === 1,
    ctaHref: event.link ?? "#",
  };
};

const timelineItems: TimelineItem[] = [
  ...upcomingEvents.map((event) => buildTimelineEvent(event, "upcoming")),
  {
    type: "divider",
    id: "past-events-divider",
    title: "Eventi passati",
    description: "Qui trovi gli eventi passati dell'Associazione Auriga.",
  },
  ...pastEvents.map((event) => buildTimelineEvent(event, "past")),
];
---

<BaseLayout
  title="Eventi — Auriga"
  headerTheme="light"
  headerClass="bg-[#faf7f2]"
  headerStyle="background-color:#faf7f2"
  pageBg="light"
>
  <section class="relative min-h-[360px] flex items-center justify-center overflow-hidden bg-[#014f97] text-white">
    <div class="absolute inset-0 bg-gradient-to-br from-[#012b5c] via-[#014f97] to-[#021b45]"></div>
    <div class="absolute left-1/2 top-[-220px] h-[460px] w-[460px] -translate-x-1/2 rounded-full bg-[radial-gradient(circle,_rgba(159,210,255,0.45),_rgba(1,79,151,0))] opacity-90"></div>
    <div class="absolute right-[12%] top-[18%] h-56 w-56 rounded-full bg-[radial-gradient(circle,_rgba(255,255,255,0.22),_rgba(1,43,92,0))] opacity-90 blur-2xl"></div>
    <div class="absolute left-[8%] bottom-[-140px] h-80 w-80 rounded-full bg-[radial-gradient(circle,_rgba(2,28,67,0.65),_rgba(1,79,151,0))] opacity-70 blur-3xl"></div>
    <div class="relative z-10 max-w-3xl mx-auto px-6 py-24 text-center">
      <h1 class="text-4xl md:text-5xl font-semibold">Eventi</h1>
    </div>
    <div class="pointer-events-none absolute -bottom-20 h-20 w-full bg-gradient-to-b from-transparent via-[#033b7a]/80 to-[#014f97] md:-bottom-28 md:h-28"></div>
  </section>
  <section class="relative bg-[#014f97] py-16 md:py-20">
    <div class="absolute inset-0 bg-gradient-to-b from-[#014f97] via-[#023b7e] to-[#012b5c]"></div>
    <div class="relative max-w-6xl mx-auto px-4">
      <div class="rounded-[28px] border-2 border-black/40 bg-white/95 shadow-[0_35px_80px_rgba(0,0,0,0.35)] backdrop-blur-sm px-6 sm:px-10 py-12">
        <header class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
          <div>
            <h2 class="text-3xl md:text-4xl font-semibold text-[#014f97]">Prossimi eventi</h2>
            <p class="mt-4 text-slate-700 max-w-2xl">
              Qui trovi i prossimi eventi dell'Associazione Auriga.
            </p>
          </div>
        </header>

        <ol class="relative mt-12 space-y-8 md:space-y-0">
          <!-- Timeline line - hidden on mobile, visible on md+ -->
          <div class="hidden md:block absolute left-1/2 top-8 bottom-8 w-0.5 -translate-x-1/2 bg-gradient-to-b from-[#014f97]/20 via-[#014f97]/60 to-[#014f97]/20" aria-hidden="true"></div>

          {timelineItems.map((item) => {
            if (item.type === "divider") {
              return (
                <li class="relative py-8 md:py-12" id={item.id}>
                  <div class="max-w-lg">
                    <h2 class="text-2xl md:text-3xl font-semibold text-[#014f97]">{item.title}</h2>
                    {item.description && (
                      <p class="mt-3 text-slate-600 leading-relaxed">{item.description}</p>
                    )}
                  </div>
                </li>
              );
            }

            return (
              <li class="relative pb-8 md:pb-16 last:pb-0">
                <!-- Mobile: stacked layout -->
                <div class="md:hidden">
                  <!-- Date/Location header -->
                  <div class="mb-4 pl-6 border-l-4 border-[#014f97]">
                    <p class="text-[11px] uppercase tracking-[0.35em] text-[#014f97] font-semibold">{item.category}</p>
                    <p class="mt-1.5 text-lg font-semibold text-slate-900">{item.date}</p>
                    <p class="mt-1 text-sm text-slate-600">{item.location}</p>
                  </div>
                  <!-- Card -->
                  <article class="group overflow-hidden rounded-2xl border border-black/10 bg-white shadow-lg" id={`${item.id}-mobile`}>
                    <img src={item.image} alt={item.imageAlt} loading="lazy" class="h-48 w-full object-cover" />
                    <div class="p-5">
                      <h3 class="text-xl font-semibold text-[#014f97]">{item.title}</h3>
                      <p class="mt-3 text-slate-700 text-sm leading-relaxed">{item.description}</p>
                      <div class="mt-5">
                        <a
                          href={item.ctaHref}
                          class="inline-flex items-center gap-2 rounded-full border border-[#014f97] px-4 py-2 text-sm font-semibold text-[#014f97] transition-colors hover:bg-[#014f97] hover:text-white"
                          aria-label={`Scopri di più su ${item.title}`}
                        >
                          Scopri di più
                          <span aria-hidden="true">→</span>
                        </a>
                      </div>
                    </div>
                  </article>
                </div>

                <!-- Desktop: zigzag layout -->
                <div class={`hidden md:grid md:grid-cols-2 md:gap-8 lg:gap-12 ${item.isInverted ? "" : ""}`}>
                  <!-- Left column -->
                  <div class={`flex ${item.isInverted ? "justify-start" : "justify-end"}`}>
                    {item.isInverted ? (
                      <article class="group max-w-md overflow-hidden rounded-2xl border border-black/10 bg-white shadow-[0_25px_60px_rgba(1,49,97,0.18)] transition-all duration-300 hover:-translate-y-1 hover:shadow-[0_30px_70px_rgba(1,49,97,0.22)]" id={item.id}>
                        <img src={item.image} alt={item.imageAlt} loading="lazy" class="h-56 w-full object-cover lg:h-64" />
                        <div class="p-6 lg:p-7">
                          <h3 class="text-2xl font-semibold text-[#014f97]">{item.title}</h3>
                          <p class="mt-4 text-slate-700 leading-relaxed">{item.description}</p>
                          <div class="mt-6">
                            <a
                              href={item.ctaHref}
                              class="inline-flex items-center gap-2 rounded-full border border-[#014f97] px-5 py-2 text-sm font-semibold text-[#014f97] transition-colors hover:bg-[#014f97] hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#014f97]"
                              aria-label={`Scopri di più su ${item.title}`}
                            >
                              Scopri di più
                              <span aria-hidden="true">→</span>
                            </a>
                          </div>
                        </div>
                      </article>
                    ) : (
                      <div class="text-right pr-8 lg:pr-12 pt-4 max-w-xs">
                        <p class="text-[11px] uppercase tracking-[0.4em] text-[#014f97] font-semibold">{item.category}</p>
                        <p class="mt-3 text-xl font-semibold text-slate-900 leading-tight">{item.date}</p>
                        <p class="mt-2 text-sm text-slate-600">{item.location}</p>
                      </div>
                    )}
                  </div>

                  <!-- Center dot -->
                  <div class="absolute left-1/2 top-6 -translate-x-1/2 z-10">
                    <span class="block w-4 h-4 rounded-full bg-[#014f97] border-[3px] border-white shadow-[0_0_0_4px_rgba(1,79,151,0.15)] transition-transform duration-300 group-hover:scale-110" aria-hidden="true"></span>
                  </div>

                  <!-- Right column -->
                  <div class={`flex ${item.isInverted ? "justify-end" : "justify-start"}`}>
                    {item.isInverted ? (
                      <div class="text-left pl-8 lg:pl-12 pt-4 max-w-xs">
                        <p class="text-[11px] uppercase tracking-[0.4em] text-[#014f97] font-semibold">{item.category}</p>
                        <p class="mt-3 text-xl font-semibold text-slate-900 leading-tight">{item.date}</p>
                        <p class="mt-2 text-sm text-slate-600">{item.location}</p>
                      </div>
                    ) : (
                      <article class="group max-w-md overflow-hidden rounded-2xl border border-black/10 bg-white shadow-[0_25px_60px_rgba(1,49,97,0.18)] transition-all duration-300 hover:-translate-y-1 hover:shadow-[0_30px_70px_rgba(1,49,97,0.22)]" id={item.id}>
                        <img src={item.image} alt={item.imageAlt} loading="lazy" class="h-56 w-full object-cover lg:h-64" />
                        <div class="p-6 lg:p-7">
                          <h3 class="text-2xl font-semibold text-[#014f97]">{item.title}</h3>
                          <p class="mt-4 text-slate-700 leading-relaxed">{item.description}</p>
                          <div class="mt-6 flex justify-end">
                            <a
                              href={item.ctaHref}
                              class="inline-flex items-center gap-2 rounded-full border border-[#014f97] px-5 py-2 text-sm font-semibold text-[#014f97] transition-colors hover:bg-[#014f97] hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#014f97]"
                              aria-label={`Scopri di più su ${item.title}`}
                            >
                              Scopri di più
                              <span aria-hidden="true">→</span>
                            </a>
                          </div>
                        </div>
                      </article>
                    )}
                  </div>
                </div>
              </li>
            );
          })}
        </ol>
      </div>
    </div>
  </section>

</BaseLayout>
