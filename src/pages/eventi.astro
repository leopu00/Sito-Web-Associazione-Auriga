---
import BaseLayout from "../layouts/BaseLayout.astro";

type EventEntry = {
  id: string;
  category: string;
  title: string;
  date: string;
  location: string;
  description: string;
  image: string;
  imageAlt: string;
  link?: string;
};

type TimelineScope = "upcoming" | "past";

type TimelineEventItem = EventEntry & {
  type: "event";
  scope: TimelineScope;
  positionIndex: number;
  isInverted: boolean;
  ctaHref: string;
};

type TimelineDividerItem = {
  type: "divider";
  id: string;
  title: string;
  description?: string;
};

type TimelineItem = TimelineEventItem | TimelineDividerItem;

const upcomingEvents: EventEntry[] = [];

const pastEvents: EventEntry[] = [
  {
    id: "sei-modalita",
    category: "arteterapia",
    title: "Sei modalità di comunicazione",
    date: "Settembre 19–21, 2025",
    location: "Accademia Aldo Bargero Oriago, Oriago (VE)",
    description:
      "Tre giorni di arteterapia per esplorare le sei modalità con cui corpo, voce e immaginazione costruiscono relazione, ascolto e cura.",
    image: "/img/accademia-aldo-bargero-2.jpg",
    imageAlt: "Ingresso dell'Accademia Oriago con luce del tramonto",
    link: "/arteterapia",
  },
  {
    id: "battaglia-rane-topi-2025-maggio",
    category: "teatro",
    title: "La battaglia delle rane e dei topi",
    date: "Maggio 2025",
    location: "Etica Bio Festival di Caulonia",
    description:
      "Spettacolo itinerante dal poemetto greco, con un viaggio condiviso tra comunità e scuole in tre tappe successive.",
    image: "/img/battaglia-rane-topi/DSCF3912.jpg",
    imageAlt: "Scena teatrale de La battaglia delle rane e dei topi",
    link: "/teatro/battaglia-rane-topi",
  },
  {
    id: "battaglia-rane-topi-2025-aprile",
    category: "teatro",
    title: "La battaglia delle rane e dei topi",
    date: "Aprile 2025",
    location: "Scuole Waldorf del Veneto",
    description:
      "Spettacolo itinerante dal poemetto greco, con un viaggio condiviso tra comunità e scuole in tre tappe successive.",
    image: "/img/battaglia-rane-topi/DSCF3838.jpg",
    imageAlt: "Scena teatrale de La battaglia delle rane e dei topi",
    link: "/teatro/battaglia-rane-topi",
  },
  {
    id: "premio-paolo-giuranna-2025",
    category: "poesia",
    title: "Premio Paolo Giuranna II.",
    date: "Marzo 2025",
    location: "Teatrino \"Eleonora Duse\", Roma",
    description:
      "Edizione 2025 del concorso per giovani interpreti, con finale aperta al pubblico nello storico teatrino romano.",
    image: "/img/premio-paolo-giuranna/_02A1876.JPG",
    imageAlt: "Vincitori del Premio Paolo Giuranna sul palco",
    link: "/poesia/premio-paolo-giuranna",
  },
  {
    id: "il-paradiso",
    category: "teatro",
    title: "Il Paradiso",
    date: "Febbraio 14–16, 2025",
    location: "Teatro Belli, Roma",
    description:
      "Messa in scena della terza cantica dantesca con un lavoro corale su voce, luce e movimento.",
    image: "/img/paradiso.jpg",
    imageAlt: "Ensemble in scena durante Il Paradiso",
    link: "/teatro/paradiso",
  },
  {
    id: "citta-poesia-4",
    category: "poesia",
    title: "La Città della Poesia IV.",
    date: "Dicembre 2024",
    location: "CAE",
    description:
      "Quarto appuntamento della rassegna con letture sceniche, musica e voci giovani dedicate alla poesia contemporanea.",
    image: "/img/citta-della-poesia/_DSF5401.JPG",
    imageAlt: "Momento di lettura durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
  {
    id: "la-tempesta-continua-2024-ottobre",
    category: "teatro",
    title: "La tempesta continua",
    date: "Ottobre 11, 2024",
    location: "Nuovo Teatro Ateneo 'Università La Sapienza'",
    description:
      "Nuova produzione liberamente ispirata alla Tempesta di Shakespeare, con musiche originali e un cast internazionale.",
    image: "/img/tempesta-continua.jpg",
    imageAlt: "Scena centrale dello spettacolo La tempesta continua",
    link: "/teatro/tempesta-continua",
  },
  {
    id: "convegno-sprachgestaltung",
    category: "convegno",
    title: "Convegno sulla Sprachgestaltung",
    date: "Ottobre 10, 2024",
    location: "Nuovo Teatro Ateneo 'Università La Sapienza'",
    description:
      "Una giornata di studio dedicata alla Sprachgestaltung con docenti e professionisti del linguaggio scenico e pedagogico.",
    image: "/img/sapienzacorso.jpg",
    imageAlt: "Relatori riuniti al Nuovo Teatro Ateneo della Sapienza",
    link: "/formazione/corsi-intensivi",
  },
  {
    id: "la-tempesta-continua-2024-luglio",
    category: "teatro",
    title: "La tempesta continua",
    date: "Luglio 2024",
    location: "Goetheaunm - Dornach",
    description:
      "Nuova produzione liberamente ispirata alla Tempesta di Shakespeare, con musiche originali e un cast internazionale.",
    image: "/img/tempesta-quartetto.jpg",
    imageAlt: "Scena centrale dello spettacolo La tempesta continua",
    link: "/teatro/tempesta-continua",
  },
  {
    id: "battaglia-rane-topi-2024-giugno",
    category: "teatro",
    title: "La battaglia delle rane e dei topi",
    date: "Giugno 2024",
    location: "CAE",
    description:
      "Spettacolo itinerante dal poemetto greco, con un viaggio condiviso tra comunità e scuole in tre tappe successive.",
    image: "/img/battaglia-rane-topi/DSCF4046.jpg",
    imageAlt: "Scena teatrale de La battaglia delle rane e dei topi",
    link: "/teatro/battaglia-rane-topi",
  },
  {
    id: "citta-poesia-3",
    category: "poesia",
    title: "La Città della Poesia III.",
    date: "Aprile 2024",
    location: "CAE",
    description:
      "Terzo incontro del ciclo con poeti ospiti, musica dal vivo e la partecipazione degli allievi dei corsi Auriga.",
    image: "/img/citta-della-poesia/_DSF5371.JPG",
    imageAlt: "Pubblico coinvolto durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
  {
    id: "premio-paolo-giuranna-2024",
    category: "poesia",
    title: "Premio Paolo Giuranna I.",
    date: "Marzo 2024",
    location: "Teatrino \"Eleonora Duse\", Roma",
    description:
      "L'edizione 2024 del premio ha dato voce a giovani interpreti provenienti da tutta Italia con prove e finale pubblica.",
    image: "/img/premio-paolo-giuranna/_MG_0518.JPG",
    imageAlt: "Interprete sul palco del Premio Paolo Giuranna",
    link: "/poesia/premio-paolo-giuranna",
  },
  {
    id: "citta-poesia-2",
    category: "poesia",
    title: "La Città della Poesia II.",
    date: "Gennaio 2024",
    location: "CAE",
    description:
      "Secondo appuntamento della rassegna con focus sulla poesia del Novecento letta ad alta voce e accompagnata da musica.",
    image: "/img/citta-della-poesia/_DSF5326.JPG",
    imageAlt: "Attori e musicisti durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
  {
    id: "citta-poesia-1",
    category: "poesia",
    title: "La Città della Poesia I.",
    date: "Novembre 2023",
    location: "CAE",
    description:
      "Debutto della rassegna con letture corali, improvvisazioni e incontri con il pubblico della città.",
    image: "/img/citta-della-poesia/Poesia2.webp",
    imageAlt: "Lettura scenica durante La Città della Poesia",
    link: "/poesia/la-citta-della-poesia",
  },
];

const categoryColors: Record<string, { bg: string; text: string; border: string; hoverBorder: string }> = {
  arteterapia: { bg: "bg-purple-50", text: "text-purple-700", border: "border-l-purple-500", hoverBorder: "hover:border-purple-400" },
  teatro: { bg: "bg-rose-50", text: "text-rose-900", border: "border-l-rose-500", hoverBorder: "hover:border-rose-400" },
  poesia: { bg: "bg-indigo-50", text: "text-indigo-700", border: "border-l-indigo-500", hoverBorder: "hover:border-indigo-400" },
  convegno: { bg: "bg-amber-50", text: "text-amber-700", border: "border-l-amber-500", hoverBorder: "hover:border-amber-400" },
};

const getCategoryColor = (category: string) => categoryColors[category] || { bg: "bg-slate-50", text: "text-slate-700", border: "border-l-slate-500", hoverBorder: "hover:border-slate-400" };

let timelineOrder = 0;

const buildTimelineEvent = (event: EventEntry, scope: TimelineScope): TimelineEventItem => {
  const positionIndex = timelineOrder++;
  return {
    ...event,
    type: "event",
    scope,
    positionIndex,
    isInverted: positionIndex % 2 === 1,
    ctaHref: event.link ?? "#",
  };
};

const timelineItems: TimelineItem[] = [
  ...upcomingEvents.map((event) => buildTimelineEvent(event, "upcoming")),
  // Show divider only if there are upcoming events
  ...(upcomingEvents.length > 0 ? [{
    type: "divider" as const,
    id: "past-events-divider",
    title: "Eventi passati",
    description: "Qui trovi gli eventi passati dell'Associazione Auriga.",
  }] : []),
  ...pastEvents.map((event) => buildTimelineEvent(event, "past")),
];
---

<BaseLayout
  title="Eventi — Auriga"
  headerTheme="light"
  headerClass=""
  headerStyle=""
  pageBg="light"
>
  <section class="relative overflow-hidden text-white">
    <!-- Mesh gradient background -->
    <div class="absolute inset-0 bg-[#1a0a2e]"></div>

    <!-- BORDO SINISTRO -->
    <div class="absolute top-[0%] left-[-15%] w-[45%] h-[30%] rounded-full bg-[#7c3aed] opacity-80 blur-[120px]"></div>
    <div class="absolute top-[20%] left-[-10%] w-[40%] h-[25%] rounded-full bg-[#3b82f6] opacity-75 blur-[110px]"></div>
    <div class="absolute top-[40%] left-[-12%] w-[42%] h-[28%] rounded-full bg-[#ec4899] opacity-70 blur-[115px]"></div>
    <div class="absolute top-[60%] left-[-8%] w-[38%] h-[25%] rounded-full bg-[#06b6d4] opacity-65 blur-[110px]"></div>
    <div class="absolute top-[80%] left-[-15%] w-[45%] h-[30%] rounded-full bg-[#8b5cf6] opacity-70 blur-[120px]"></div>

    <!-- BORDO DESTRO -->
    <div class="absolute top-[0%] right-[-15%] w-[45%] h-[30%] rounded-full bg-[#ec4899] opacity-80 blur-[120px]"></div>
    <div class="absolute top-[18%] right-[-10%] w-[40%] h-[25%] rounded-full bg-[#f97316] opacity-75 blur-[110px]"></div>
    <div class="absolute top-[38%] right-[-12%] w-[42%] h-[28%] rounded-full bg-[#a855f7] opacity-70 blur-[115px]"></div>
    <div class="absolute top-[58%] right-[-8%] w-[38%] h-[25%] rounded-full bg-[#f472b6] opacity-65 blur-[110px]"></div>
    <div class="absolute top-[78%] right-[-15%] w-[45%] h-[30%] rounded-full bg-[#f97316] opacity-70 blur-[120px]"></div>

    <!-- CENTRO - HERO (riempito) -->
    <div class="absolute top-[-5%] left-[25%] w-[50%] h-[35%] rounded-full bg-[#8b5cf6] opacity-70 blur-[120px]"></div>
    <div class="absolute top-[0%] left-[35%] w-[45%] h-[30%] rounded-full bg-[#c084fc] opacity-65 blur-[110px]"></div>
    <div class="absolute top-[5%] left-[15%] w-[40%] h-[28%] rounded-full bg-[#06b6d4] opacity-70 blur-[100px]"></div>
    <div class="absolute top-[5%] left-[50%] w-[40%] h-[28%] rounded-full bg-[#d946ef] opacity-75 blur-[100px]"></div>
    <div class="absolute top-[10%] left-[30%] w-[45%] h-[30%] rounded-full bg-[#f472b6] opacity-60 blur-[110px]"></div>
    <div class="absolute top-[8%] left-[30%] w-[40%] h-[30%] rounded-full bg-[#fbbf24] opacity-75 blur-[90px]"></div>
    <div class="absolute top-[3%] left-[45%] w-[35%] h-[25%] rounded-full bg-[#facc15] opacity-65 blur-[85px]"></div>
    <div class="absolute top-[15%] left-[45%] w-[35%] h-[25%] rounded-full bg-[#10b981] opacity-55 blur-[100px]"></div>
    <div class="absolute top-[18%] left-[35%] w-[40%] h-[28%] rounded-full bg-[#fb7185] opacity-60 blur-[105px]"></div>

    <!-- CENTRO - MIDDLE -->
    <div class="absolute top-[28%] left-[15%] w-[40%] h-[28%] rounded-full bg-[#22d3d1] opacity-60 blur-[110px]"></div>
    <div class="absolute top-[30%] left-[45%] w-[38%] h-[26%] rounded-full bg-[#c084fc] opacity-65 blur-[110px]"></div>
    <div class="absolute top-[35%] left-[30%] w-[40%] h-[28%] rounded-full bg-[#f97316] opacity-55 blur-[110px]"></div>
    <div class="absolute top-[40%] left-[20%] w-[35%] h-[25%] rounded-full bg-[#818cf8] opacity-60 blur-[100px]"></div>
    <div class="absolute top-[42%] left-[50%] w-[35%] h-[25%] rounded-full bg-[#fb923c] opacity-55 blur-[100px]"></div>

    <!-- CENTRO - BOTTOM -->
    <div class="absolute top-[50%] left-[25%] w-[40%] h-[28%] rounded-full bg-[#e879f9] opacity-60 blur-[110px]"></div>
    <div class="absolute top-[55%] left-[40%] w-[38%] h-[26%] rounded-full bg-[#14b8a6] opacity-55 blur-[110px]"></div>
    <div class="absolute top-[60%] left-[15%] w-[42%] h-[28%] rounded-full bg-[#6366f1] opacity-60 blur-[115px]"></div>
    <div class="absolute top-[65%] left-[45%] w-[40%] h-[28%] rounded-full bg-[#ec4899] opacity-55 blur-[110px]"></div>
    <div class="absolute top-[70%] left-[25%] w-[45%] h-[30%] rounded-full bg-[#0ea5e9] opacity-55 blur-[115px]"></div>
    <div class="absolute top-[75%] left-[35%] w-[40%] h-[28%] rounded-full bg-[#d946ef] opacity-50 blur-[110px]"></div>
    <div class="absolute top-[82%] left-[20%] w-[45%] h-[30%] rounded-full bg-[#fbbf24] opacity-50 blur-[115px]"></div>
    <div class="absolute top-[88%] left-[40%] w-[40%] h-[28%] rounded-full bg-[#7c3aed] opacity-55 blur-[110px]"></div>

    <!-- Hero content -->
    <div class="relative z-10 min-h-[380px] md:min-h-[440px] flex items-center justify-center">
      <div class="max-w-3xl mx-auto px-6 py-24 md:py-28 text-center">
        <h1 class="text-4xl md:text-6xl font-bold tracking-tight drop-shadow-lg">Eventi</h1>
      </div>
    </div>

    <!-- Timeline content -->
    <div class="relative z-10 pb-16 md:pb-20">
      <div class="max-w-6xl mx-auto px-4">
      <div class="rounded-[28px] border-2 border-black/40 bg-white/95 shadow-[0_35px_80px_rgba(0,0,0,0.35)] backdrop-blur-sm px-6 sm:px-10 py-12">
        <!-- Titolo e intro -->
        <div class="text-center mb-8">
          <h2 class="text-2xl md:text-3xl font-semibold text-slate-800">I nostri eventi</h2>
          <p class="mt-3 text-slate-600 max-w-2xl mx-auto">Dal 2023 organizziamo spettacoli, letture, workshop e incontri dedicati all'arte della parola e al teatro.</p>
        </div>

        <!-- Linea divisoria -->
        <div class="mb-10 pb-8 border-b border-slate-200"></div>

        <ol class="relative space-y-8 md:space-y-0">
          <!-- Timeline line - hidden on mobile, visible on md+ -->
          <div class="hidden md:block absolute left-1/2 top-8 bottom-8 w-0.5 -translate-x-1/2 bg-gradient-to-b from-[#014f97]/20 via-[#014f97]/60 to-[#014f97]/20" aria-hidden="true"></div>

          {timelineItems.map((item) => {
            if (item.type === "divider") {
              return (
                <li class="relative py-8 md:py-12" id={item.id}>
                  <div class="max-w-lg">
                    <h2 class="text-2xl md:text-3xl font-semibold text-[#014f97]">{item.title}</h2>
                    {item.description && (
                      <p class="mt-3 text-slate-600 leading-relaxed">{item.description}</p>
                    )}
                  </div>
                </li>
              );
            }

            return (
              <li class="relative pb-8 md:pb-16 last:pb-0">
                <!-- Mobile: stacked layout -->
                <div class="md:hidden">
                  <!-- Date/Location header -->
                  <div class={`mb-4 pl-5 border border-black/10`}>
                    <span class={`inline-block px-2.5 py-1 rounded-full text-[10px] font-semibold uppercase tracking-wider ${getCategoryColor(item.category).bg} ${getCategoryColor(item.category).text}`}>
                      {item.category}
                    </span>
                    <p class="mt-2 text-lg font-semibold text-slate-900">{item.date}</p>
                    <p class="mt-1 text-sm text-slate-600">{item.location}</p>
                  </div>
                  <!-- Card -->
                  <article class={`group overflow-hidden rounded-2xl border border-black/10 bg-white shadow-lg`} id={`${item.id}-mobile`}>
                    <img src={item.image} alt={item.imageAlt} loading="lazy" class="h-48 w-full object-cover" />
                    <div class="p-5">
                      <h3 class="text-xl font-semibold text-slate-900">{item.title}</h3>
                      <p class="mt-3 text-slate-600 text-sm leading-relaxed">{item.description}</p>
                      <div class="mt-5">
                        <a
                          href={item.ctaHref}
                          class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2.5 text-sm font-semibold text-slate-700 transition-colors hover:bg-slate-900 hover:text-white hover:border-slate-900"
                          aria-label={`Scopri di più su ${item.title}`}
                        >
                          Scopri di più
                          <span aria-hidden="true">→</span>
                        </a>
                      </div>
                    </div>
                  </article>
                </div>

                <!-- Desktop: zigzag layout -->
                <div class={`hidden md:grid md:grid-cols-2 md:gap-8 lg:gap-12 ${item.isInverted ? "" : ""}`}>
                  <!-- Left column -->
                  <div class={`flex ${item.isInverted ? "justify-end pr-4" : "justify-end pr-4"}`}>
                    {item.isInverted ? (
                      <article class={`group max-w-md overflow-hidden rounded-2xl border-2 border-transparent bg-white shadow-[0_25px_60px_rgba(1,49,97,0.18)] transition-all duration-300 hover:-translate-y-2 hover:shadow-[0_35px_80px_rgba(1,49,97,0.25)] hover:border-slate-200`} id={item.id}>
                        <img src={item.image} alt={item.imageAlt} loading="lazy" class="h-56 w-full object-cover lg:h-64" />
                        <div class="p-6 lg:p-8">
                          <h3 class="text-2xl font-semibold text-slate-900">{item.title}</h3>
                          <p class="mt-3 text-slate-600 leading-relaxed">{item.description}</p>
                          <div class="mt-6">
                            <a
                              href={item.ctaHref}
                              class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-5 py-2.5 text-sm font-semibold text-slate-700 transition-colors hover:bg-slate-900 hover:text-white hover:border-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-slate-500"
                              aria-label={`Scopri di più su ${item.title}`}
                            >
                              Scopri di più
                              <span aria-hidden="true">→</span>
                            </a>
                          </div>
                        </div>
                      </article>
                    ) : (
                      <div class="text-right pt-4">
                        <span class={`inline-block px-2.5 py-1 rounded-full text-[10px] font-semibold uppercase tracking-wider ${getCategoryColor(item.category).bg} ${getCategoryColor(item.category).text}`}>
                          {item.category}
                        </span>
                        <p class="mt-2 text-xl font-semibold text-slate-900 leading-tight">{item.date}</p>
                        <p class="mt-1.5 text-sm text-slate-600">{item.location}</p>
                      </div>
                    )}
                  </div>

                  <!-- Center dot - colored by category -->
                  <div class="absolute left-1/2 top-6 -translate-x-1/2 z-10">
                    <span class={`block w-4 h-4 rounded-full border-[3px] border-white shadow-[0_0_0_4px_rgba(0,0,0,0.08)] transition-transform duration-300 group-hover:scale-125 ${
                      item.category === "arteterapia" ? "bg-purple-500" :
                      item.category === "teatro" ? "bg-rose-500" :
                      item.category === "poesia" ? "bg-indigo-500" :
                      item.category === "convegno" ? "bg-amber-500" : "bg-slate-500"
                    }`} aria-hidden="true"></span>
                  </div>

                  <!-- Right column -->
                  <div class={`flex ${item.isInverted ? "justify-start pl-4" : "justify-start pl-4"}`}>
                    {item.isInverted ? (
                      <div class="text-left pt-4">
                        <span class={`inline-block px-2.5 py-1 rounded-full text-[10px] font-semibold uppercase tracking-wider ${getCategoryColor(item.category).bg} ${getCategoryColor(item.category).text}`}>
                          {item.category}
                        </span>
                        <p class="mt-2 text-xl font-semibold text-slate-900 leading-tight">{item.date}</p>
                        <p class="mt-1.5 text-sm text-slate-600">{item.location}</p>
                      </div>
                    ) : (
                      <article class={`group max-w-md overflow-hidden rounded-2xl border-2 border-transparent bg-white shadow-[0_25px_60px_rgba(1,49,97,0.18)] transition-all duration-300 hover:-translate-y-2 hover:shadow-[0_35px_80px_rgba(1,49,97,0.25)] hover:border-slate-200`} id={item.id}>
                        <img src={item.image} alt={item.imageAlt} loading="lazy" class="h-56 w-full object-cover lg:h-64" />
                        <div class="p-6 lg:p-8">
                          <h3 class="text-2xl font-semibold text-slate-900">{item.title}</h3>
                          <p class="mt-3 text-slate-600 leading-relaxed">{item.description}</p>
                          <div class="mt-6 flex justify-end">
                            <a
                              href={item.ctaHref}
                              class="inline-flex items-center gap-2 rounded-full border border-slate-300 px-5 py-2.5 text-sm font-semibold text-slate-700 transition-colors hover:bg-slate-900 hover:text-white hover:border-slate-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-slate-500"
                              aria-label={`Scopri di più su ${item.title}`}
                            >
                              Scopri di più
                              <span aria-hidden="true">→</span>
                            </a>
                          </div>
                        </div>
                      </article>
                    )}
                  </div>
                </div>
              </li>
            );
          })}
        </ol>
      </div>
      </div>
    </div>
  </section>

</BaseLayout>
